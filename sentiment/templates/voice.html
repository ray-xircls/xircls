<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Recognition</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button, select { padding: 10px 20px; margin: 5px; }
    #transcript {
      margin-top: 20px;
      font-size: 1.2em;
      border: 1px solid #ccc;
      padding: 10px;
      min-height: 50px;
    }
  </style>
</head>
<body>
  <h1>Voice Recognition</h1>
  
  <label for="micSelect">Select Microphone:</label>
  <select id="micSelect"></select>
  <br>
  
  <button id="start">Start Recording</button>
  <button id="stop" disabled>Stop Recording</button>
  <div id="transcript">Your transcribed text will appear here...</div>
  
  <script>
    // Check for Web Speech API support
    var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("Your browser does not support the Web Speech API. Please use Chrome or another supported browser.");
    }
    
    // Create a SpeechRecognition instance
    var recognition = new SpeechRecognition();
    recognition.continuous = true;    // Continue listening until stopped
    recognition.interimResults = true;  // Display partial results
    
    var transcriptElem = document.getElementById('transcript');
    var startButton = document.getElementById('start');
    var stopButton = document.getElementById('stop');
    var micSelect = document.getElementById('micSelect');
    var selectedDeviceId = null;
    
    // Populate the dropdown with available audio input devices
    function populateMicList() {
      navigator.mediaDevices.enumerateDevices().then(function(devices) {
        micSelect.innerHTML = ''; // Clear any existing options
        devices.forEach(function(device) {
          if (device.kind === 'audioinput') {
            var option = document.createElement('option');
            option.value = device.deviceId;
            option.text = device.label || 'Microphone ' + (micSelect.length + 1);
            micSelect.appendChild(option);
          }
        });
        if (micSelect.options.length > 0) {
          selectedDeviceId = micSelect.options[0].value;
        }
      }).catch(function(err) {
        console.error("Error enumerating devices: ", err);
      });
    }
    
    // Update selected device when user changes the dropdown
    micSelect.addEventListener('change', function() {
      selectedDeviceId = micSelect.value;
    });
    
    // Request permission using getUserMedia with the selected microphone
    function getAudioPermissionAndStart() {
      var constraints = {
        audio: {
          deviceId: selectedDeviceId ? { exact: selectedDeviceId } : undefined
        }
      };
      navigator.mediaDevices.getUserMedia(constraints)
        .then(function(stream) {
          // Once permission is granted, start recognition.
          // Note: SpeechRecognition doesn't accept a stream, but calling getUserMedia
          // with the chosen device may help the browser use that mic.
          recognition.start();
          // Stop the stream immediately as we only needed permission.
          stream.getTracks().forEach(track => track.stop());
        })
        .catch(function(err) {
          console.error("Error accessing audio: ", err);
        });
    }
    
    recognition.onresult = function(event) {
      var transcript = "";
      for (var i = event.resultIndex; i < event.results.length; ++i) {
        transcript += event.results[i][0].transcript;
      }
      transcriptElem.textContent = transcript;
    };
    
    recognition.onerror = function(event) {
      console.error("Speech recognition error: ", event.error);
    };
    
    startButton.addEventListener('click', function() {
      transcriptElem.textContent = "";  // Clear previous transcript
      getAudioPermissionAndStart();
      startButton.disabled = true;
      stopButton.disabled = false;
    });
    
    stopButton.addEventListener('click', function() {
      recognition.stop();
      startButton.disabled = false;
      stopButton.disabled = true;
    });
    
    // Populate microphone dropdown on page load
    populateMicList();
  </script>
</body>
</html>
